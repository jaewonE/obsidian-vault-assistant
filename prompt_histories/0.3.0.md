Before starting work, familiarize yourself with README.md, AGENTS.md, and CHANGELOGS.md. This task is for version 0.2.0, where the goal is UI/UX improvement.

We will be working on version 0.3.0, and we plan to fundamentally review and refactor the BM25 algorithm, chat save & load algorithm, and architecture.

The current major issue is as follows:

The BM25 algorithm is not functioning properly. For example, the file "heapsort.md" exists, and within it, "documentation content clearly includes the word 'heapsort' and describes the heapsort algorithm." Therefore, when asked to "explain heapsort," this document should be available through the source code. However, it is not.

Before starting, analyze how the BM25-based document retrieval system works for source exploration and determine why the BM25 algorithm fails to retrieve the appropriate files. While the code cannot be executed for analysis, "no code modifications should be performed." Your response should include your analysis, the suspected cause, and a proposed solution.

---

Reviewed `README.md`, `AGENTS.md`, and `CHANGELOGS.md` first (read-only).  
Note: repository currently shows `0.2.2` (2026-02-24), and BM25 core behavior appears unchanged from the earlier BM25 introduction.

**How BM25 retrieval currently works**
1. Query enters `handleUserQuery` and calls BM25 search with settings (`topN`, `cutoffRatio`, `minK`, `k1`, `b`) in [NotebookLMPlugin.ts:293](file:///Users/jaewone/developer/utils/obsidian/current_using/obsidian-vault-assistant/src/plugin/NotebookLMPlugin.ts:293).
2. BM25 indexes all markdown file contents from `app.vault.getMarkdownFiles()` in [BM25.ts:136](file:///Users/jaewone/developer/utils/obsidian/current_using/obsidian-vault-assistant/src/search/BM25.ts:136).
3. Tokenization is `text.toLowerCase().replace(/[^a-z0-9\\s]/g, " ")` in [BM25.ts:176](file:///Users/jaewone/developer/utils/obsidian/current_using/obsidian-vault-assistant/src/search/BM25.ts:176).
4. It computes BM25 scores, sorts all docs, slices top N, applies cutoff, then enforces min K in [BM25.ts:91](file:///Users/jaewone/developer/utils/obsidian/current_using/obsidian-vault-assistant/src/search/BM25.ts:91), [BM25.ts:105](file:///Users/jaewone/developer/utils/obsidian/current_using/obsidian-vault-assistant/src/search/BM25.ts:105), [BM25.ts:110](file:///Users/jaewone/developer/utils/obsidian/current_using/obsidian-vault-assistant/src/search/BM25.ts:110).
5. Selected paths are uploaded/reused and passed as `source_ids` to NotebookLM in [NotebookLMPlugin.ts:414](file:///Users/jaewone/developer/utils/obsidian/current_using/obsidian-vault-assistant/src/plugin/NotebookLMPlugin.ts:414).

**Suspected root cause (high confidence)**
- The tokenizer is ASCII-only (`[a-z0-9]`), so multilingual tokens or many non-ASCII forms are dropped before indexing/querying.  
- When token matching fails, code still ranks zero-score docs and force-selects by `minK`, producing effectively arbitrary files instead of “no lexical match.” This happens because all docs start at score `0` in [BM25.ts:65](file:///Users/jaewone/developer/utils/obsidian/current_using/obsidian-vault-assistant/src/search/BM25.ts:65), and zero-score docs are still eligible for selection in [BM25.ts:108](file:///Users/jaewone/developer/utils/obsidian/current_using/obsidian-vault-assistant/src/search/BM25.ts:108), [BM25.ts:110](file:///Users/jaewone/developer/utils/obsidian/current_using/obsidian-vault-assistant/src/search/BM25.ts:110).  
- This makes BM25 *look broken* in cases like “should retrieve heapsort.md but doesn’t,” especially when tokenization mismatch occurs (`heapsort` vs `heap sort`, non-English query terms, etc.).

**Secondary contributing factors**
- Only file content is indexed; filename/path/title are not boosted or indexed, so exact filename intent (`heapsort.md`) is not leveraged.
- No explicit “no-match” guard (`queryTokens.length===0` or `topScore<=0`) before source selection/upload.

**Proposed solution for v0.3.0**
1. Replace tokenizer with Unicode-aware normalization (NFKC + `\p{L}\p{N}` token extraction).
2. Add explicit no-match handling:
   - if query tokens empty or no postings matched, return empty selection with reason.
   - never force `minK` from zero-score docs.
3. Rank/select only positive-score docs.
4. Add fielded retrieval:
   - index `filename/path + headings + body`, with boosts (e.g., filename/headings > body).
5. Add observability:
   - log query tokens, matched tokens, matched doc count, nonzero-score count.
6. Add regression tests:
   - `heapsort` query must retrieve `heapsort.md`.
   - multilingual query tokenization cases.
   - `heap sort` vs `heapsort` normalization cases.

No code changes were made.

---

The identified cause is quite relevant. In fact, the document contains numerous English, Korean, Japanese, and various Latex formulas. Resolve this issue by implementing all of the suggested solutions, as well as additional suggestions and tests.